{"entries":[{"timestamp":1726115523622,"editorVersion":"7.0.40","changes":[{"type":"edited","filename":"main.blocks","patch":[{"diffs":[[0,"http"],[-1,"s"],[0,"://"],[-1,"developers.google.com/blockly/xml\"><variables></variables><block type=\"pxt-on-start\" id=\"xSzu;j2s]+0O5e@P/[$r\" x=\"20\" y=\"20"],[1,"www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start"],[0,"\"></"]],"start1":12,"start2":12,"length1":135,"length2":62},{"diffs":[[0,"</block>"],[1,"\n  "],[0,"<block t"]],"start1":72,"start2":72,"length1":16,"length2":19},{"diffs":[[0,"ver\""],[-1," id=\"`5al=f!:qcK:Qr8jO:G1\" x=\"225\" y=\"20\""],[0,"></b"]],"start1":107,"start2":107,"length1":49,"length2":8},{"diffs":[[0,"</block>"],[1,"\n"],[0,"</xml>"]],"start1":112,"start2":112,"length1":14,"length2":15}]},{"type":"edited","filename":"main.ts","patch":[{"diffs":[[-1,"basic.forever(function () {\n\t\n})"],[0,"\n"]],"start1":0,"start2":0,"length1":33,"length2":1}]},{"type":"edited","filename":"pxt.json","patch":[{"diffs":[[0,".md\""],[-1,",\n        \"uartwifi-KODAIRA3.ts\"\n    ],\n    \"testFiles\": [\n        \"test.ts\"\n    ],\n    \"preferredEditor\": \"tsprj\""],[1,"\n    ],\n    \"additionalFilePaths\": []"],[0,"\n}\n"]],"start1":216,"start2":216,"length1":121,"length2":44}]},{"type":"added","filename":"test.ts","value":"// テストはここに来ます。このパッケージが拡張機能として使用されるときにはコンパイルされません。\n"},{"type":"added","filename":"uartwifi-KODAIRA3.ts","value":"/**\n * Custom blocks\n */\n//% weight=100 color=#0fbc11 icon=\"\" block=\"IFTTT連携\"\nnamespace IMLuartwifiv2 {\n    let isWifiConnected = false\n\n    //% block\n    //% weight=100\n    //% block=\"IFTTTに送信する|Event %event|Key %key|value1 %value1|value2 %value2|value3 %value3\"\n    //% value1.defl=\"hello\"\n    //% value2.defl=\"micro\"\n    //% value3.defl=\"bit\"\n    export function sendToIFTTT(value1: string, value2: string, value3: string) {\n        let result = 0\n        let retry = 2\n        let event = \"spread_notify\"\n        let key = \"bdPxgUp39hNCdI4doqu4Lh\"\n\n        // close the previous TCP connection\n        if (isWifiConnected) {\n            sendAtCmd(\"AT+CIPCLOSE\")\n            waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n        }\n\n        while (isWifiConnected && retry > 0) {\n            retry = retry - 1;\n            // establish TCP connection\n            sendAtCmd(\"AT+CIPSTART=\\\"TCP\\\",\\\"maker.ifttt.com\\\",80\")\n            result = waitAtResponse(\"OK\", \"ALREADY CONNECTED\", \"ERROR\", 2000)\n            if (result == 3) continue\n\n            let data = \"GET /trigger/\" + event + \"/with/key/\" + key\n            data = data + \"?value1=\" + value1\n            data = data + \"&value2=\" + value2\n            data = data + \"&value3=\" + value3\n            data = data + \" HTTP/1.1\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"User-Agent: curl/7.58.0\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Host: maker.ifttt.com\"\n            data = data + \"\\u000D\\u000A\"\n            data = data + \"Accept: */*\"\n            data = data + \"\\u000D\\u000A\"\n\n            sendAtCmd(\"AT+CIPSEND=\" + (data.length + 2))\n            result = waitAtResponse(\">\", \"OK\", \"ERROR\", 2000)\n            if (result == 3) continue\n            sendAtCmd(data)\n            result = waitAtResponse(\"SEND OK\", \"SEND FAIL\", \"ERROR\", 5000)\n\n            // // close the TCP connection\n            // sendAtCmd(\"AT+CIPCLOSE\")\n            // waitAtResponse(\"OK\", \"ERROR\", \"None\", 2000)\n\n            if (result == 1) break\n        }\n    }\n\n    //% block\n    //% block=\"WiFiを設定する|TX %txPin|RX %rxPin|Baud rate %baudrate|SSID = %ssid|Password = %passwd\"\n    //% weight=100    \n    //% txPin.defl=SerialPin.P15\n    //% rxPin.defl=SerialPin.P1\n    //% baudRate.defl=BaudRate.BaudRate115200    export function setupWifi(txPin: SerialPin, rxPin: SerialPin, baudRate: BaudRate, ssid: string, passwd: string) {\n    export function setupWifi() {\n        let result = 0\n        let txPin = SerialPin.P14\n        let rxPin = SerialPin.P8\n        let baudRate = BaudRate.BaudRate115200\n        let ssid = \"BMOON-1F\"\n        let passwd = \"2002112100\"\n\n        isWifiConnected = false\n\n        serial.redirect(\n            txPin,\n            rxPin,\n            baudRate\n        )\n\n        sendAtCmd(\"AT\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(\"AT+CWMODE=1\")\n        result = waitAtResponse(\"OK\", \"ERROR\", \"None\", 1000)\n\n        sendAtCmd(`AT+CWJAP=\"${ssid}\",\"${passwd}\"`)\n        result = waitAtResponse(\"WIFI GOT IP\", \"ERROR\", \"None\", 20000)\n\n        if (result == 1) {\n            isWifiConnected = true\n        }\n    }\n\n    //% block\n    //% weight=100    \n    //% block=\"WiFiOK\"\n    export function wifiOK(): boolean {\n        return isWifiConnected\n    }\n\n    function sendAtCmd(cmd: string) {\n        serial.writeString(cmd + \"\\u000D\\u000A\")\n    }\n\n    function waitAtResponse(target1: string, target2: string, target3: string, timeout: number) {\n        let buffer = \"\"\n        let start = input.runningTime()\n\n        while ((input.runningTime() - start) < timeout) {\n            buffer += serial.readString()\n\n            if (buffer.includes(target1)) return 1\n            if (buffer.includes(target2)) return 2\n            if (buffer.includes(target3)) return 3\n\n            basic.pause(100)\n        }\n\n        return 0\n    }\n}\n"}]}],"snapshots":[{"timestamp":1726115523621,"editorVersion":"7.0.40","text":{"main.blocks":"<xml xmlns=\"http://www.w3.org/1999/xhtml\">\n  <block type=\"pxt-on-start\"></block>\n  <block type=\"device_forever\"></block>\n</xml>","main.ts":"\n","README.md":"","pxt.json":"{\n    \"name\": \"題名未設定\",\n    \"description\": \"\",\n    \"dependencies\": {\n        \"core\": \"*\",\n        \"radio\": \"*\",\n        \"microphone\": \"*\"\n    },\n    \"files\": [\n        \"main.blocks\",\n        \"main.ts\",\n        \"README.md\"\n    ],\n    \"additionalFilePaths\": []\n}\n"}}],"shares":[],"lastSaveTime":1726115917831}